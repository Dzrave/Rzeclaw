<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rzeclaw Terminal</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; }
    #toolbar { padding: 8px 12px; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 12px; }
    #status { font-size: 12px; color: #666; }
    #status.connected { color: green; }
    #status.error { color: red; }
    #sessionList { width: 200px; border-right: 1px solid #ddd; overflow-y: auto; padding: 8px; }
    #main { flex: 1; display: flex; overflow: hidden; }
    #chatArea { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    #rightPanel { width: 280px; border-left: 1px solid #ddd; display: flex; flex-direction: column; overflow: hidden; }
    #rightPanel .panelSection { padding: 8px; border-bottom: 1px solid #eee; }
    #rightPanel .panelSection h3 { margin: 0 0 6px 0; font-size: 12px; color: #666; }
    #canvasGoal, #canvasSteps, #proposalsList { font-size: 12px; white-space: pre-wrap; max-height: 120px; overflow-y: auto; }
    #proposalsList, #heartbeatResult { margin-top: 4px; }
    #btnProactive, #btnHeartbeat { margin-top: 6px; padding: 4px 8px; font-size: 12px; }
    #messages { flex: 1; overflow-y: auto; padding: 12px; }
    .msg { margin-bottom: 12px; }
    .msg.user { color: #06c; }
    .msg.assistant { color: #333; white-space: pre-wrap; word-break: break-word; }
    #inputRow { padding: 8px; border-top: 1px solid #ddd; display: flex; gap: 8px; }
    #input { flex: 1; min-height: 60px; padding: 8px; resize: none; font-family: inherit; }
    #sendBtn { padding: 8px 16px; }
    #settings { padding: 20px; max-width: 400px; }
    #settings label { display: block; margin-top: 12px; }
    #settings input { width: 100%; padding: 6px; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div id="toolbar">
    <span id="status">未连接</span>
    <span id="connectionWrap" class="hidden" style="margin-left:8px;">
      <label>连接</label>
      <select id="connectionSelect" style="min-width:120px;"></select>
    </span>
    <button id="btnSettings">设置</button>
    <button id="btnConnect">连接</button>
  </div>
  <div id="main" class="hidden">
    <div id="sessionList"></div>
    <div id="chatArea">
      <div id="sessionTypeRow" style="padding:6px 12px;border-bottom:1px solid #eee;display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
        <label>会话类型</label>
        <select id="sessionTypeSelect">
          <option value="general">通用</option>
          <option value="dev">开发</option>
          <option value="knowledge">知识库</option>
          <option value="pm">PM</option>
          <option value="swarm_manager">蜂群管理</option>
        </select>
        <span id="teamWrap" class="hidden" style="margin-left:8px;">
          <label>协调团队</label>
          <select id="teamSelect"><option value="">（无）</option></select>
        </span>
        <span id="consultHint" class="hidden" style="margin-left:8px;font-size:11px;color:#666;">依据知识库回答</span>
      </div>
      <div id="messages"></div>
      <div id="inputRow">
        <textarea id="input" placeholder="输入消息…"></textarea>
        <button id="sendBtn">发送</button>
      </div>
    </div>
    <div id="rightPanel">
      <div class="panelSection">
        <h3>画布</h3>
        <div id="canvasGoal"></div>
        <div id="canvasSteps"></div>
        <button id="btnRefreshCanvas">刷新画布</button>
        <div style="margin-top:8px;border-top:1px solid #eee;padding-top:6px;">
          <label style="font-size:11px;color:#666;">编辑目标</label>
          <textarea id="canvasGoalEdit" rows="2" style="width:100%;font-size:12px;margin-top:2px;" placeholder="目标…"></textarea>
          <label style="font-size:11px;color:#666;">编辑步骤（每行一条，可加 [pending]/[in_progress]/[done]）</label>
          <textarea id="canvasStepsEdit" rows="4" style="width:100%;font-size:12px;margin-top:2px;" placeholder="步骤1\n步骤2 [done]\n"></textarea>
          <button id="btnSaveCanvas" style="margin-top:4px;">保存画布</button>
        </div>
      </div>
      <div class="panelSection">
        <h3>主动提议</h3>
        <div id="proposalsList"></div>
        <button id="btnProactive">获取建议</button>
      </div>
      <div class="panelSection">
        <h3>Heartbeat</h3>
        <div id="heartbeatResult"></div>
        <button id="btnHeartbeat">手动触发</button>
      </div>
      <div class="panelSection">
        <h3>工具</h3>
        <div id="toolsList"></div>
        <button id="btnToolsList">刷新列表</button>
      </div>
    </div>
  </div>
  <div id="connectError" class="hidden" style="padding:20px;color:red;"></div>
  <div id="settingsPanel" class="hidden">
    <div id="settings">
      <h2>设置</h2>
      <label>连接配置（多连接）</label>
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <select id="settingConnectionSelect" style="min-width:160px;"></select>
        <button id="btnAddConnection">添加</button>
        <button id="btnDeleteConnection">删除当前</button>
      </div>
      <label>Gateway 地址 (ws/wss)</label>
      <div style="display:flex;gap:8px;">
        <input type="text" id="settingUrl" placeholder="ws://127.0.0.1:18789" style="flex:1;" />
        <button id="btnScan">扫描局域网</button>
      </div>
      <div id="scanResults" style="font-size:12px;margin-top:6px;max-height:80px;overflow:auto;"></div>
      <label>API Key（可选，认证时必填）</label>
      <input type="password" id="settingApiKey" placeholder="" />
      <button id="btnSaveSettings">保存并连接</button>
    </div>
  </div>
  <script src="renderer.js"></script>
</body>
</html>
